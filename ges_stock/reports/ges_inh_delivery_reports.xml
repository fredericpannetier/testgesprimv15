<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Bon de prépa -->
    <template id="ges_report_picking" inherit_id="stock.report_picking" priority="99">
        <xpath expr="//h1[@t-field='o.name']" position="replace">
            <h2>
                <t t-if="o.picking_type_id.code=='incoming'">
                    <span>Receipt </span>
                </t>
                <t t-else="">
                    <span>Delivery </span> 
                </t> 
                <span t-field="o.name"/>
            </h2>
        </xpath>        
        <xpath expr="//th[@name='th_product']" position="replace">
            <th name="th_product" class="text-left">
                <div>
                    <strong>Product</strong>
                </div>
                <div>
                    <strong>Category - Size</strong>
                </div>
            </th>
            <th name="ges_th_orig_brand" class="text-left">
                <div>
                    <strong>Origin</strong>
                </div>
                <div>
                    <strong>Brand</strong>
                </div>
            </th>
        </xpath>
        <xpath expr="//th[@name='ges_th_orig_brand']" position="after">
            <th name="ges_th_packages" class="text-right">
                <div>
                    <strong>Packages</strong>
                </div>
            </th>
            <th name="ges_th_pieces" class="text-right">
                <div>
                    <strong>Pieces</strong>
                </div>
            </th>
            <th name="ges_th_nweight" class="text-right">
                <div>
                    <strong>Net weight</strong>
                </div>
                <div>
                    <strong>Gross weight</strong>
                </div>
            </th>
        </xpath>
        <xpath expr="//table[1]/tbody" position="replace">

            <tbody>
                <t t-foreach="o.move_ids_without_package" t-as="move">
                    <t t-foreach="move.move_line_ids.sorted(key=lambda ml: ml.location_id.id)" t-as="ml">

                        <tr>

                            <td>
                                <div>
                                    <span t-field="ml.product_id.display_name" />
                                    <br />
                                    <span t-field="ml.product_id.description_picking" />
                                </div>
                                <div>
                                    <span t-field="ml.move_id.ges_category_id.name" />
                                    -
                                    <span t-field="ml.move_id.ges_size_id.name" />
                                </div>
                            </td>
                            <td name="ges_td_orig_brand" class="text-left">
                                <div>
                                    <span t-field="ml.move_id.ges_origin_id.name" />
                                </div>
                                <div>
                                    <span t-field="ml.move_id.ges_brand_id.name" />
                                </div>
                            </td>
                            <td name="ges_td_packages" class="text-right">
                                <div>
                                    <span t-field="ml.ges_pack" />
                                </div>
                            </td>
                            <td name="ges_td_pieces" class="text-right">
                                <div>
                                    <span t-field="ml.ges_piece" />
                                </div>
                            </td>
                            <td name="ges_td_nweight" class="text-right">
                                <div>
                                    <span t-field="ml.ges_nweight" />
                                </div>
                                <div>
                                    <span t-field="ml.ges_gweight" />
                                </div>
                            </td>
                            <td>
                                <span t-if="o.state != 'done'" t-field="ml.product_uom_qty" />
                                <span t-if="o.state == 'done'" t-field="ml.qty_done" />
                                <span t-field="ml.product_uom_id" groups="uom.group_uom" />
                            </td>
                            <td t-if="o.picking_type_id.code != 'incoming'" groups="stock.group_stock_multi_locations">
                                <span t-esc="ml.location_id.display_name" />
                                <t t-if="ml.package_id">
                                    <span t-field="ml.package_id" />
                                </t>
                            </td>
                            <td t-if="o.picking_type_id.code != 'outgoing'" groups="stock.group_stock_multi_locations">
                                <div>
                                    <span t-field="ml.location_dest_id" />
                                    <t t-if="ml.result_package_id">
                                        <span t-field="ml.result_package_id" />
                                    </t>
                                </div>
                            </td>
                            <td class=" text-center h6" t-if="has_serial_number">
                                <img t-if="has_serial_number and (ml.lot_id or ml.lot_name)" t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s&amp;humanreadable=1' % ('Code128', ml.lot_id.name or ml.lot_name, 400, 100)" style="width:100%;height:35px;" alt="Barcode" />

                            </td>
                            <td class="text-center" t-if="has_barcode">
                                <t t-if="product_barcode != move.product_id.barcode">
                                    <span t-if="move.product_id and move.product_id.barcode">
                                        <img t-if="len(move.product_id.barcode) == 13" t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s&amp;quiet=%s' % ('EAN13', move.product_id.barcode, 400, 100, 0)" style="height:35px" alt="Barcode" />
                                        <img t-elif="len(move.product_id.barcode) == 8" t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s&amp;quiet=%s' % ('EAN8', move.product_id.barcode, 400, 100, 0)" style="height:35px" alt="Barcode" />
                                        <img t-else="" t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s&amp;quiet=%s' % ('Code128', move.product_id.barcode, 400, 100, 0)" style="height:35px" alt="Barcode" />

                                    </span>
                                    <t t-set="product_barcode" t-value="move.product_id.barcode" />
                                </t>
                            </td>
                        </tr>
                    </t>
                </t>
            </tbody>

        </xpath>

    </template>


    <template id="ges_report_delivery_document" inherit_id="stock.report_delivery_document" priority="99">
        <xpath expr="//div[contains(@class, 'page')]/h2" position="replace">
            <h2>
                <t t-if="o.picking_type_id.code=='incoming'">
                    <span>Receipt </span>
                </t>
                <t t-else="">
                    <span>Delivery </span> 
                </t> 
                <span t-field="o.name"/>
            </h2>
        </xpath>
        
        <xpath expr="//div[contains(@class, 'page')]" position="before">
            <t t-if="partner">
                <t t-if="o.partner_id.parent_id">
                    <t t-set="ges_valuated" t-value="o.partner_id.parent_id.ges_val_deliv" />
                </t>
                <t t-if="not o.partner_id.parent_id">
                    <t t-set="ges_valuated" t-value="o.partner_id.ges_val_deliv" />
                </t>
            </t>
            <t t-if="ges_force_valuated">
                <t t-set="ges_valuated" t-value="True" />
            </t>
            <t t-if="ges_force_nonvaluated">
                <t t-set="ges_valuated" t-value="False" />
            </t>
        </xpath>

        <xpath expr="//table[@name='stock_move_table']" position="before">

            <t t-set="total_amount" t-value="0" />
        </xpath>
        <!-- Livraison non validée -->
        <xpath expr="//th[@name='th_sm_product']" position="replace">
            <th name="th_sm_product" class="text-left">
                <div>Product</div>
                <div>Category - Size</div>
            </th>
            <th name="ges_th_sm_orig_brand" class="text-left">
                <div>Origin</div>
                <div>Brand</div>
            </th>
        </xpath>
        <xpath expr="//th[@name='th_sm_quantity']" position="before">

            <th name="ges_th_sm_packages" class="text-right">
                <div>Packages</div>
            </th>
            <th name="ges_th_sm_pieces" class="text-right">
                <div>Pieces</div>
            </th>
            <th name="ges_th_sm_nweight" class="text-right">
                <div>Net weight</div>
                <div>Gross weight</div>
            </th>
        </xpath>
        <xpath expr="//th[@name='th_sm_quantity']" position="after">
            <t t-if="ges_valuated">
                <th class="text-right">Unit price</th>
                <th class="text-right">Amount</th>

            </t>
        </xpath>
        <xpath expr="//table[@name='stock_move_table']/tbody/t/tr/td[1]" position="replace">
            <td>
                <div>
                    <span t-field="move.product_id" />
                    <p t-if="move.description_picking != move.product_id.name">
                        <span t-field="move.description_picking" />
                    </p>
                </div>
                <div>
                    <span t-field="move.ges_category_id.name" />
                    -
                    <span t-field="move.ges_size_id.name" />
                </div>
            </td>
            <td name="ges_td_orig_brand" class="text-left">
                <div>
                    <span t-field="move.ges_origin_id.name" />
                </div>
                <div>
                    <span t-field="move.ges_brand_id.name" />
                </div>
            </td>
        </xpath>
        <xpath expr="//table[@name='stock_move_table']/tbody/t/tr/td[3]" position="after">
            <t t-if="ges_valuated">
                <t t-if="move.sale_line_id or move.purchase_line_id ">
                    <t t-if="move.sale_line_id">
                        <td class="text-right">
                            <span t-field="move.sale_line_id.price_unit" />
                        </td>
                        <td class="text-right">
                            <span t-field="move.ges_amount" />
                        </td>
                    </t>
                    <t t-if="move.purchase_line_id">
                        <td class="text-right">
                            <span t-field="move.purchase_line_id.price_unit" />
                        </td>
                        <td class="text-right">
                            <span t-field="move.ges_amount" />
                        </td>
                    </t>
                </t>
                <t t-else="">
                    <td></td>
                    <td></td>
                </t>
            </t>
        </xpath>
        <xpath expr="//table[@name='stock_move_table']/tbody/t/tr/td[3]" position="before">

            <td name="ges_td_packages" class="text-right">
                <div>
                    <span t-field="move.ges_pack" />
                </div>
            </td>
            <td name="ges_td_pieces" class="text-right">
                <div>
                    <span t-field="move.ges_piece" />
                </div>
            </td>
            <td name="ges_td_nweight" class="text-right">
                <div>
                    <span t-field="move.ges_nweight" />
                </div>
                <div>
                    <span t-field="move.ges_gweight" />
                </div>
            </td>
        </xpath>
        <xpath expr="//table[@name='stock_move_table']/tbody//t[@t-foreach='lines']" position="after">
            <t t-if="ges_valuated">
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <t t-if="has_serial_number">
                        <td></td>
                    </t>
                    <td class="text-right">Total amount</td>

                    <td class="text-right">
                        <span t-esc="'%.2f'% o.ges_amount" />
                    </td>
                </tr>
            </t>
            <tr name="ges_total_line1">
                <td></td>
                <td></td>
                <t t-if="has_serial_number">
                    <td></td>
                </t>
                <td class="text-right">
                    <div>
                        Total packages :
                        <span t-field="o.ges_pack" />
                    </div>
                </td>
                <td class="text-right">
                    <div>
                        Total pieces :
                        <span t-field="o.ges_piece" />
                    </div>
                </td>
                <td class="text-right">
                    <div>
                        Total net weight :
                        <span t-field="o.ges_nweight" />
                    </div>
                    <div>
                        Total gross weight :
                        <span t-field="o.ges_gweight" />
                    </div>
                </td>
                <td></td>
                <t t-if="ges_valuated">
                    <td></td>
                    <td></td>
                </t>
            </tr>
        </xpath>

        <!-- Livraison validée entête colonnes -->
        <xpath expr="//th[@name='th_sml_product']" position="replace">
            <th name="th_sml_product" class="text-left">
                <div>
                    <strong>Product</strong>
                </div>
                <div>Category - Size</div>
            </th>
            <th name="ges_th_sml_orig_brand" class="text-left">
                <div>Origin</div>
                <div>Brand</div>
            </th>
        </xpath>
        <xpath expr="//th[@name='th_sml_quantity']" position="before">

            <th name="ges_th_sml_packages" class="text-right">
                <div>Packages</div>
            </th>
            <th name="ges_th_sml_pieces" class="text-right">
                <div>Pieces</div>
            </th>
            <th name="ges_th_sml_nweight_size" class="text-right">
                <div>Net weight</div>
                <div>Gross weight</div>
            </th>
        </xpath>

        <xpath expr="//th[@name='th_sml_quantity']" position="after">
            <t t-if="ges_valuated">
                <th class="text-right">Unit price</th>
                <th class="text-right">Amount</th>
            </t>
        </xpath>
        <!-- Livraison validée après les lignes lignes -->
        <xpath expr="//table[@name='stock_move_line_table']/tbody//tr[@t-foreach='package_move_lines']" position="after">
            <t t-if="ges_valuated">
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <t t-if="has_serial_number">
                        <td></td>
                    </t>
                    <td class="text-right">Total amount</td>
                    <td class="text-right">
                        <span t-esc="'%.2f'% o.ges_amount" />
                    </td>
                </tr>
            </t>
            <tr name="ges_total_line2">
                <td></td>
                <td></td>
                <t t-if="has_serial_number">
                    <td></td>
                </t>
                <td class="text-right">
                    <div>
                        Total packages :
                        <span t-field="o.ges_pack" />
                    </div>
                </td>
                <td class="text-right">
                    <div>
                        Total pieces :
                        <span t-field="o.ges_piece" />
                    </div>
                </td>
                <td class="text-right">
                    <div>
                        Total net weight :
                        <span t-field="o.ges_nweight" />
                    </div>
                    <div>
                        Total gross weight :
                        <span t-field="o.ges_gweight" />
                    </div>
                </td>
                <td></td>
                <t t-if="ges_valuated">
                    <td></td>
                    <td></td>
                </t>
            </tr>
        </xpath>

        <xpath expr="//table[@name='stock_move_line_table']/tbody//tr[@t-foreach='move_lines']" position="after">
            <t t-if="ges_valuated">
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <t t-if="has_serial_number">
                        <td></td>
                    </t>
                    <td class="text-right">Total amount</td>
                    <td class="text-right">
                        <span t-esc="'%.2f'% o.ges_amount" />
                    </td>
                </tr>
            </t>
            <tr name="ges_total_line3">
                <td></td>
                <td></td>
                <t t-if="has_serial_number">
                    <td></td>
                </t>
                <td class="text-right">
                    <div>
                        Total packages :
                        <span t-field="o.ges_pack" />
                    </div>
                </td>
                <td class="text-right">
                    <div>
                        Total pieces :
                        <span t-field="o.ges_piece" />
                    </div>
                </td>
                <td class="text-right">
                    <div>
                        Total net weight :
                        <span t-field="o.ges_nweight" />
                    </div>
                    <div>
                        Total gross weight :
                        <span t-field="o.ges_gweight" />
                    </div>
                </td>
                <td></td>
                <t t-if="ges_valuated">
                    <td></td>
                    <td></td>
                </t>
            </tr>
        </xpath>

        <xpath expr="//table[@name='stock_move_line_table']/tbody//t[@t-foreach='o.move_line_ids']" position="after">
            <t t-if="ges_valuated">
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <t t-if="has_serial_number">
                        <td></td>
                    </t>
                    <td class="text-right">Total amount</td>
                    <td class="text-right">
                        <span t-esc="'%.2f'% o.ges_amount" />
                    </td>
                </tr>
            </t>
            <tr name="ges_total_line4">
                <td></td>
                <td></td>
                <t t-if="has_serial_number">
                    <td></td>
                </t>
                <td class="text-right">
                    <div>
                        Total packages :
                        <span t-field="o.ges_pack" />
                    </div>
                </td>
                <td class="text-right">
                    <div>
                        Total pieces :
                        <span t-field="o.ges_piece" />
                    </div>
                </td>
                <td class="text-right">
                    <div>
                        Total net weight :
                        <span t-field="o.ges_nweight" />
                    </div>
                    <div>
                        Total gross weight :
                        <span t-field="o.ges_gweight" />
                    </div>
                </td>
                <td></td>
                <t t-if="ges_valuated">
                    <td></td>
                    <td></td>
                </t>
            </tr>
        </xpath>


    </template>
    <!-- Livraison validée détail lignes avec n° de série -->
    <template id="ges_stock_report_delivery_has_serial_move_line" inherit_id="stock.stock_report_delivery_has_serial_move_line" priority="99">
        <xpath expr="//td[1]" position="replace">
            <td>
                <div>
                    <span t-field="move_line.product_id" />
                    <!-- this is an annoying workaround for the multiple types of descriptions (often auto-filled) that we do not want to print -->
                    <!-- this makes it so we can pre-filter the descriptions in inherited templates since we cannot extend the standard "if" condition -->
                    <!-- let's agree that pre-filtered descriptions will be set to "" -->
                    <t t-if="not description and description != ''">
                        <t t-set="description" t-value="move_line.move_id.description_picking" />
                    </t>
                    <p t-if="description !='' and description != move_line.product_id.name">
                        <span t-esc="description" />
                    </p>
                </div>
                <div>
                    <span t-field="move_line.move_id.ges_category_id.name" />
                    -
                    <span t-field="move_line.move_id.ges_size_id.name" />
                </div>
            </td>
            <td name="ges_td_orig_brand" class="text-left">
                <div>
                    <span t-field="move_line.move_id.ges_origin_id.name" />
                </div>
                <div>
                    <span t-field="move_line.move_id.ges_brand_id.name" />
                </div>
            </td>
        </xpath>
        <xpath expr="//td[3]" position="after">
            <t t-if="ges_valuated">
                <t t-if="move_line.move_id.sale_line_id or move_line.move_id.purchase_line_id">
                    <t t-if="move_line.move_id.sale_line_id">
                        <td class="text-right">
                            <span t-field="move_line.move_id.sale_line_id.price_unit" />
                        </td>
                        <td class="text-right">
                            <span t-field="move_line.ges_amount" />
                        </td>
                    </t>
                    <t t-if="move_line.move_id.purchase_line_id">
                        <td class="text-right">
                            <span t-field="move_line.move_id.purchase_line_id.price_unit" />
                        </td>
                        <td class="text-right">
                            <span t-field="move_line.ges_amount" />
                        </td>
                    </t>
                </t>
                <t t-else="">
                    <td></td>
                    <td></td>
                </t>
            </t>
        </xpath>
        <xpath expr="//td[3]" position="before">

            <td name="ges_td_packages" class="text-right">
                <div>
                    <span t-field="move_line.ges_pack" />
                </div>
            </td>
            <td name="ges_td_pieces" class="text-right">
                <div>
                    <span t-field="move_line.ges_piece" />
                </div>
            </td>
            <td name="ges_td_nweight" class="text-right">
                <div>
                    <span t-field="move_line.ges_nweight" />
                </div>
                <div>
                    <span t-field="move_line.ges_gweight" />
                </div>
            </td>

        </xpath>


    </template>
    <!-- Livraison validée détail lignes sans n° de série -->
    <template id="ges_stock_report_delivery_aggregated_move_lines" inherit_id="stock.stock_report_delivery_aggregated_move_lines" priority="99">
        <xpath expr="//tr/td[1]" position="replace">
            <td>
                <div>
                    <span t-esc="aggregated_lines[line]['name']" />
                    <p t-if="aggregated_lines[line]['description']">
                        <span t-esc="aggregated_lines[line]['description']" />
                    </p>
                </div>
                <div>
                    <span t-esc="aggregated_lines[line]['ges_category_des']" />
                    -
                    <span t-esc="aggregated_lines[line]['ges_size_des']" />
                </div>
            </td>
            <td name="ges_td_orig_brand" class="text-left">
                <div>
                    <span t-esc="aggregated_lines[line]['ges_origin_des']" />
                </div>
                <div>
                    <span t-esc="aggregated_lines[line]['ges_brand_des']" />
                </div>
            </td>
        </xpath>
        <xpath expr="//td[@name='move_line_aggregated_qty_done']" position="before">

            <td name="ges_td_packages" class="text-right">
                <div>
                    <span t-esc="aggregated_lines[line]['ges_pack']" />
                </div>
            </td>
            <td name="ges_td_pieces" class="text-right">
                <div>
                    <span t-esc="aggregated_lines[line]['ges_piece']" />
                </div>
            </td>
            <td name="ges_td_nweight" class="text-right">
                <div>
                    <span t-esc="aggregated_lines[line]['ges_nweight']" />
                </div>
                <div>
                    <span t-esc="aggregated_lines[line]['ges_gweight']" />
                </div>
            </td>

        </xpath>
        <xpath expr="//td[@name='move_line_aggregated_qty_done']" position="after">
            <t t-if="ges_valuated">
                <t t-if="aggregated_lines[line]['sale_line_id'] or aggregated_lines[line]['purchase_line_id']">
                    <t t-set="price_unit" t-value="aggregated_lines[line]['ges_price_unit']" />
                    <td class="text-right">
                        <span t-esc="price_unit" />
                    </td>
                    <t t-set="move_amount" t-value="(aggregated_lines[line]['ges_price_unit'] * aggregated_lines[line]['qty_done'])" />
                    <td class="text-right">
                        <span t-esc="'%.2f'% move_amount" />
                    </td>
                    <t t-set="total_amount" t-value="total_amount + move_amount" />
                </t>
                <t t-else="">
                    <td></td>
                    <td></td>
                </t>
            </t>

        </xpath>
        <xpath expr="//t[@t-foreach='aggregated_lines']" position="after">
            <t t-if="ges_valuated">
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <t t-if="has_serial_number">
                        <td></td>
                    </t>
                    <td></td>
                    <td class="text-right">Total amount</td>
                    <td class="text-right">
                        <span t-esc="'%.2f'% total_amount" />
                    </td>
                </tr>
            </t>
            <tr name="ges_total_line">
                <td></td>
                <td></td>
                <t t-if="has_serial_number">
                    <td></td>
                </t>
                <td class="text-right">
                    <div>
                        Total packages :
                        <span t-field="o.ges_pack" />
                    </div>
                </td>
                <td class="text-right">
                    <div>
                        Total pieces :
                        <span t-field="o.ges_piece" />
                    </div>
                </td>
                <td class="text-right">
                    <div>
                        Total net weight :
                        <span t-field="o.ges_nweight" />
                    </div>
                    <div>
                        Total gross weight :
                        <span t-field="o.ges_gweight" />
                    </div>
                </td>
                <td></td>
                <t t-if="ges_valuated">
                    <td></td>
                    <td></td>
                </t>
            </tr>
        </xpath>
    </template>
    <template id="ges_report_delivery_document_firstlot">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <t t-set="o" t-value="o.with_context(lang=o.partner_id.lang)" />
                <t t-set="partner" t-value="o.partner_id or (o.move_lines and o.move_lines[0].partner_id) or False" />
                <t t-if="partner" name="partner_header">
                    <t t-set="address">
                        <div t-esc="partner" t-options='{"widget": "contact", "fields": ["address", "name", "phone"], "no_marker": True}' />
                    </t>
                </t>
                <t t-if="partner">
                    <t t-if="o.partner_id.parent_id">
                        <t t-set="ges_valuated" t-value="o.partner_id.parent_id.ges_val_deliv" />
                    </t>
                    <t t-if="not o.partner_id.parent_id">
                        <t t-set="ges_valuated" t-value="o.partner_id.ges_val_deliv" />
                    </t>
                </t>
                <t t-if="ges_force_valuated">
                    <t t-set="ges_valuated" t-value="True" />
                </t>
                <t t-if="ges_force_nonvaluated">
                    <t t-set="ges_valuated" t-value="False" />
                </t>

                <div class="page">
                    <h2>
                        <t t-if="o.picking_type_id.code=='incoming'">
                            <span>Receipt </span>
                        </t>
                        <t t-else="">
                            <span>Delivery </span> 
                        </t> 
                        <span t-field="o.name" />
                    </h2>
                    <div class="row mt32 mb32">
                        <div t-if="o.origin" class="col-auto" name="div_origin">
                            <strong>Order:</strong>
                            <p t-field="o.origin" />
                        </div>
                        <div t-if="o.state" class="col-auto" name="div_sched_date">
                            <strong>Shipping Date:</strong>
                            <t t-if="o.state == 'done'">
                                <p t-field="o.date_done" />
                            </t>
                            <t t-if="o.state != 'done'">
                                <p t-field="o.scheduled_date" />
                            </t>
                        </div>
                    </div>
                    <table class="table table-sm" name="stock_move_table">
                        <thead>
                            <tr>
                                <th name="th_sml_product" class="text-left">
                                    <div>
                                        <strong>Product</strong>
                                    </div>
                                    <div>Category - Size</div>
                                </th>
                                <th name="ges_th_sml_lot" class="text-right">
                                    <div>Lot</div>
                                </th>
                                <th name="ges_th_sml_orig_brand" class="text-left">
                                    <div>Origin</div>
                                    <div>Brand</div>
                                </th>

                                <th name="ges_th_sml_packages" class="text-right">
                                    <div>Packages</div>
                                </th>
                                <th name="ges_th_sml_pieces" class="text-right">
                                    <div>Pieces</div>
                                </th>
                                <th name="ges_th_sml_nweight_size" class="text-right">
                                    <div>Net weight</div>
                                    <div>Gross weight</div>
                                </th>
                                <th name="ges_th_sml_qty" class="text-right">
                                    <div>Quantity</div>
                                </th>


                                <t t-if="ges_valuated">
                                    <th class="text-right">Unit price</th>
                                    <th class="text-right">Amount</th>
                                </t>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-if="o.state!='done'">
                                <t t-set="lines" t-value="o.move_lines.filtered(lambda x: x.product_uom_qty)" />
                            </t>
                            <t t-else="">
                                <t t-set="lines" t-value="o.move_lines.filtered(lambda x: x.product_uom_qty)" />
                            </t>
                            <tr t-foreach="lines" t-as="move">
                                <td>
                                    <div>
                                        <span t-field="move.product_id" />
                                        <!-- this is an annoying workaround for the multiple types of descriptions (often auto-filled) that we do not want to print -->
                                        <!-- this makes it so we can pre-filter the descriptions in inherited templates since we cannot extend the standard "if" condition -->
                                        <!-- let's agree that pre-filtered descriptions will be set to "" -->
                                        <t t-if="not description and description != ''">
                                            <t t-set="description" t-value="move.description_picking" />
                                        </t>
                                        <p t-if="description !='' and description != move.product_id.name">
                                            <span t-esc="description" />
                                        </p>
                                    </div>
                                    <div>
                                        <span t-field="move.ges_category_id.name" />
                                        -
                                        <span t-field="move.ges_size_id.name" />
                                    </div>
                                </td>
                                <td name="ges_td_lot" class="text-left">
                                    <div>
                                        <span t-field="move.ges_firstlot" />
                                    </div>
                                </td>
                                <td name="ges_td_orig_brand" class="text-left">
                                    <div>
                                        <span t-field="move.ges_origin_id.name" />
                                    </div>
                                    <div>
                                        <span t-field="move.ges_brand_id.name" />
                                    </div>
                                </td>
                                <td name="ges_td_packages" class="text-right">
                                    <div>
                                        <span t-field="move.ges_pack" />
                                    </div>
                                </td>
                                <td name="ges_td_pieces" class="text-right">
                                    <div>
                                        <span t-field="move.ges_piece" />
                                    </div>
                                </td>
                                <td name="ges_td_nweight" class="text-right">
                                    <div>
                                        <span t-field="move.ges_nweight" />
                                    </div>
                                    <div>
                                        <span t-field="move.ges_gweight" />
                                    </div>
                                </td>
                                <td>
                                    <t t-if="o.state!='done'">
                                        <span t-field="move.product_uom_qty" />
                                    </t>
                                    <t t-else="">
                                        <span t-field="move.product_uom_qty" />
                                    </t>
                                    <span t-field="move.product_uom" />
                                </td>
                                <t t-if="ges_valuated">
                                    <t t-if="move.sale_line_id or move.purchase_line_id">
                                        <t t-if="move.sale_line_id">
                                            <td class="text-right">
                                                <span t-field="move.sale_line_id.price_unit" />
                                            </td>
                                            <td class="text-right">
                                                <span t-field="move.ges_amount" />
                                            </td>
                                        </t>
                                        <t t-if="move.purchase_line_id">
                                            <td class="text-right">
                                                <span t-field="move.purchase_line_id.price_unit" />
                                            </td>
                                            <td class="text-right">
                                                <span t-field="move.ges_amount" />
                                            </td>
                                        </t>
                                    </t>
                                    <t t-else="">
                                        <td></td>
                                        <td></td>
                                    </t>
                                </t>
                            </tr>
                            <t t-if="ges_valuated">
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td class="text-right">
                                        <div>
                                            Total packages :
                                            <span t-field="o.ges_pack" />
                                        </div>
                                    </td>
                                    <td class="text-right">
                                        <div>
                                            Total pieces :
                                            <span t-field="o.ges_piece" />
                                        </div>
                                    </td>
                                    <td class="text-right">
                                        <div>
                                            Total net weight :
                                            <span t-field="o.ges_nweight" />
                                        </div>
                                        <div>
                                            Total gross weight :
                                            <span t-field="o.ges_gweight" />
                                        </div>
                                    </td>
                                    <td></td>
                                    <td class="text-right">Total amount</td>
                                    <td class="text-right">
                                        <span t-esc="'%.2f'% o.ges_amount" />
                                    </td>
                                </tr>
                            </t>
                            <t t-else="">
                                <tr name="ges_total_line_">
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td class="text-right">
                                        <div>
                                            Total packages :
                                            <span t-field="o.ges_pack" />
                                        </div>
                                    </td>
                                    <td class="text-right">
                                        <div>
                                            Total pieces :
                                            <span t-field="o.ges_piece" />
                                        </div>
                                    </td>
                                    <td class="text-right">
                                        <div>
                                            Total net weight :
                                            <span t-field="o.ges_nweight" />
                                        </div>
                                        <div>
                                            Total gross weight :
                                            <span t-field="o.ges_gweight" />
                                        </div>
                                    </td>
                                    <td></td>

                                </tr>
                            </t>
                        </tbody>
                    </table>
                    <div t-if="o.signature" class="mt32 ml64 mr4" name="signature">
                        <div class="offset-8">
                            <strong>Signature</strong>
                        </div>
                        <div class="offset-8">
                            <img t-att-src="image_data_uri(o.signature)" style="max-height: 4cm; max-width: 8cm;" />
                        </div>
                        <div class="offset-8 text-center">
                            <p t-field="o.partner_id.name" />
                        </div>
                    </div>
                </div>
            </t>
        </t>
    </template>
    <template id="valuated_report_deliveryslip">
        <t t-set="ges_force_valuated" t-value="True" />
        <t t-foreach="docs" t-as="o">
            <t t-if="o.ges_copies == 0">
                <t t-set="copies" t-value="1" />
            </t>
            <t t-else="">
                <t t-set="copies" t-value="o.ges_copies" />
            </t>
            <t t-foreach="range(copies)" t-as="n">
                <t t-if="o.ges_imp_lot == 'first'">
                    <t t-call="ges_stock.ges_report_delivery_document_firstlot" t-lang="o.partner_id.lang" />
                </t>
                <t t-else="">
                    <t t-call="stock.report_delivery_document" t-lang="o.partner_id.lang" />
                </t>
            </t>
        </t>
    </template>
    <template id="nonvaluated_report_deliveryslip">
        <t t-set="ges_force_nonvaluated" t-value="True" />
        <t t-foreach="docs" t-as="o">
            <t t-if="o.ges_copies == 0">
                <t t-set="copies" t-value="1" />
            </t>
            <t t-else="">
                <t t-set="copies" t-value="o.ges_copies" />
            </t>
            <t t-foreach="range(copies)" t-as="n">
                <t t-if="o.ges_imp_lot == 'first'">
                    <t t-call="ges_stock.ges_report_delivery_document_firstlot" t-lang="o.partner_id.lang" />
                </t>
                <t t-else="">
                    <t t-call="stock.report_delivery_document" t-lang="o.partner_id.lang" />
                </t>
            </t>
        </t>
    </template>
    <record id="ges_action_report_delivery_valuated" model="ir.actions.report">
        <field name="name">Valuated delivery Slip</field>
        <field name="model">stock.picking</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ges_stock.valuated_report_deliveryslip</field>
        <field name="report_file">ges_stock.valuated_report_deliveryslip</field>
        <field name="print_report_name">'Delivery Slip - %s - %s' % (object.partner_id.name or '', object.name)</field>
        <field name="binding_model_id" ref="model_stock_picking" />
        <field name="binding_type">report</field>
    </record>
    <record id="ges_action_report_delivery_nonvaluated" model="ir.actions.report">
        <field name="name">Non valuated delivery Slip</field>
        <field name="model">stock.picking</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">ges_stock.nonvaluated_report_deliveryslip</field>
        <field name="report_file">ges_stock.nonvaluated_report_deliveryslip</field>
        <field name="print_report_name">'Delivery Slip - %s - %s' % (object.partner_id.name or '', object.name)</field>
        <field name="binding_model_id" ref="model_stock_picking" />
        <field name="binding_type">report</field>
    </record>

    <template id="ges_report_deliveryslip" inherit_id="stock.report_deliveryslip">
        <xpath expr="//t[@t-call='stock.report_delivery_document']" position="replace">
            <t t-if="o.ges_copies == 0">
                <t t-set="copies" t-value="1" />
            </t>
            <t t-else="">
                <t t-set="copies" t-value="o.ges_copies" />
            </t>
            <t t-foreach="range(copies)" t-as="n">
                <t t-if="o.ges_imp_lot == 'first'">
                    <t t-call="ges_stock.ges_report_delivery_document_firstlot" t-lang="o.partner_id.lang" />
                </t>
                <t t-else="">
                    <t t-call="stock.report_delivery_document" t-lang="o.partner_id.lang" />
                </t>
            </t>
        </xpath>
    </template>

    <template id="ges_report_deliveryslip" inherit_id="stock.report_deliveryslip">
        <xpath expr="//t[@t-call='stock.report_delivery_document']" position="replace">
            <t t-if="o.ges_copies == 0">
                <t t-set="copies" t-value="1" />
            </t>
            <t t-else="">
                <t t-set="copies" t-value="o.ges_copies" />
            </t>
            <t t-foreach="range(copies)" t-as="n">
                <t t-if="o.ges_imp_lot == 'first'">
                    <t t-call="ges_stock.ges_report_delivery_document_firstlot" t-lang="o.partner_id.lang" />
                </t>
                <t t-else="">
                    <t t-call="stock.report_delivery_document" t-lang="o.partner_id.lang" />
                </t>
            </t>
        </xpath>
    </template>

</odoo>